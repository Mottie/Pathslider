!function(a){a.pathslider=function(b,c){var d,e=this;e.$el=a(b).addClass("pathslider"),e.el=b,e.$el.data("pathslider",e),e.init=function(){var b;e.options=d=a.extend(!0,{},a.pathslider.defaults,c),b=document.createElement("canvas"),e.hasCanvas=!(!b.getContext||!b.getContext("2d")),e.hasTouch=document.hasOwnProperty("ontouchend"),e.$grip=a("<div></div>").appendTo(e.$el),e.points=[],e.pointsxy=[],e.arrayX=[],e.arrayY=[],e.arrayP=[],e.rad2deg=180/Math.PI,e.sliding=!1,e.lastPercent=e.percent=d.value,a.each("create update start slide change stop".split(" "),function(b,c){a.isFunction(d[c])&&e.$el.bind(c+".pathslider",d[c])}),a(document).bind(e.hasTouch?"touchend.pathslider touchcancel.pathslider":"mouseup.pathslider mouseleave.pathslider",function(a){e.sliding&&(e.$el.trigger("stop.pathslider",[e]),e.lastPercent!==e.percent&&(e.lastPercent=e.percent,e.$el.trigger("change.pathslider",[e]))),e.$grip.removeClass("sliding"),e.sliding=!1}).bind((e.hasTouch?"touchmove":"mousemove")+".pathslider",function(a){e.sliding&&e.setSlider(e.findPos(a),null,!0)}),a(window).bind("resize.pathslider",function(){e.update()}).bind("load",function(){e.sliderDim[0]=e.$el.offset().left,e.sliderDim[1]=e.$el.offset().top}),e.$grip.bind((e.hasTouch?"touchstart":"mousedown")+".pathslider",function(b){return e.sliding=!0,a(this).addClass("sliding"),e.$el.trigger("start.pathslider",[e]),!1}).bind("click",function(){return!1}),e.redraw(),e.$el.trigger("create.pathslider",[e])},e.update=function(){e.$grip.attr("class","pathslider-grip "+d.gripClass),e.ctx&&e.ctx.clearRect(0,0,e.sliderDim[2],e.sliderDim[3]),e.sliderDim=[e.$el.offset().left,e.$el.offset().top,e.$el.width(),e.$el.height()];var b=window.getComputedStyle(e.$grip[0]);e.gripCenter=[parseInt(b.width,10)/2,parseInt(b.height,10)/2],e.dataPoints=d.dataPoints,e.makeArray();var c=a.inArray(e.percent,e.arrayP);e.position=c===-1?Math.round(e.percent/100*e.dataPoints):c,e.setSlider(e.percent,null,!0),e.hasCanvas&&d.useCanvas&&e.drawCurve()},e.setSlider=function(a,b,c){if(!isNaN(a)){a=parseFloat(a,10),a=a>100?100:a<0?0:a;var f,g,h=e.calcBezier(a/100,e.pointsxy),i=a-2>0?e.calcBezier((a-2)/100,e.pointsxy):h,j=a+2<100?e.calcBezier((a+2)/100,e.pointsxy):h,k=j[0]-i[0]===0?90:(j[1]-i[1])/(j[0]-i[0]);e.angle=parseInt(Math.atan(k)*e.rad2deg,10),g="rotate("+e.angle+"deg)",f=d.rotateGrip?{"-webkit-transform":g,transform:g}:{},f.left=h[0]-e.gripCenter[0],f.top=h[1]-e.gripCenter[1],e.$grip.attr({"data-angle":e.angle,"data-percent":a}).css(f),e.percent=a,(a===e.lastPercent||e.sliding)&&c||e.$el.trigger("change.pathslider",[e])}"function"==typeof b&&b(e)},e.mousePos=function(a){return[(a.originalEvent.touches?a.originalEvent.touches[0].pageX:a.pageX)-e.sliderDim[0],(a.originalEvent.touches?a.originalEvent.touches[0].pageY:a.pageY)-e.sliderDim[1]]},e.findPos=function(a){var b,c,f,g,h=[],i=[],j=e.position,k=parseInt(d.tolerance+1,10)||2,l=parseInt(d.range,10)||e.gripCenter[0],m=e.mousePos(a);for(b=0;b<l;b++){for(h=[],i=[],c=0;c<k+1;c++){if(f=Math.abs(e.arrayX[j+c]-m[0])<=b,g=Math.abs(e.arrayY[j+c]-m[1])<=b,f&&g)return e.returnPos(j+c);if(f&&h.push(j+c),g&&i.push(j+c),f=Math.abs(e.arrayX[j-c]-m[0])<=b,g=Math.abs(e.arrayY[j-c]-m[1])<=b,f&&g)return e.returnPos(j-c);f&&h.push(j-c),g&&i.push(j-c)}if(1===h.length&&i.length>1)return e.returnPos(h[0]);if(1===i.length&&h.length>1)return e.returnPos(i[0])}return e.returnPos(j)},e.returnPos=function(a){var b=e.position===a;return e.percent=e.arrayP[a],e.position=a,b||(e.hasCanvas&&d.useCanvas&&e.drawCurve(),e.$el.trigger("slide.pathslider",[e])),e.percent},e.makeArray=function(){var a,b,c=e.pointsxy,d=e.dataPoints;for(a=0;a<d+1;a++)b=e.calcBezier(a/d,c),e.arrayX[a]=b[0],e.arrayY[a]=b[1],e.arrayP[a]=b[2]},e.calcBezier=function(a,b){var c=a*a,d=1-a,e=d*d,f=d*e,g=3*a*e,h=3*c*d,i=a*c;return[Math.round(b[0]*f+b[2]*g+b[4]*h+b[6]*i),Math.round(b[1]*f+b[3]*g+b[5]*h+b[7]*i),Math.round(1e3*a)/10]},e.convert2xy=function(a){return a=a||e.points,[a[0],a[1],a[0]+a[2],a[1]+a[3],a[6]+a[4],a[7]+a[5],a[6],a[7]]},e.redraw=function(a){e.points=e.options.points=a||e.options.points,e.pointsxy=e.convert2xy(),e.update(),e.drawCurve(),e.setSlider(e.percent,null,!0)},e.drawCurve=function(){var b,c,f,g=e.pointsxy;e.$el.find("canvas").length||(a('<canvas class="pathslider-canvas"></canvas>').appendTo(e.$el),e.$canvas=e.$el.find("canvas").attr({width:e.sliderDim[2],height:e.sliderDim[3]}),e.canvas=e.$canvas[0],e.ctx=e.canvas.getContext("2d")),b=e.ctx,b.clearRect(0,0,e.sliderDim[2],e.sliderDim[3]),b.lineCap=d.curve.cap,b.lineJoin=d.curve.cap,b.lineWidth=d.curve.width,a.isArray(d.curve.color)?(c=b.createLinearGradient(g[0],g[1],g[6],g[7]),f=e.percent/100,c.addColorStop(0,d.curve.color[0]),c.addColorStop(f,d.curve.color[0]),f+.01<=1&&(f+=.01),c.addColorStop(f,d.curve.color[1]),c.addColorStop(1,d.curve.color[1]),b.strokeStyle=c):b.strokeStyle=d.curve.color,f=!0,"function"==typeof d.drawCanvas&&(f=d.drawCanvas(e,b,g)!==!1,b=e.ctx),f===!0&&e.finishCurve(b,g)},e.finishCurve=function(a,b){a=a||e.ctx,b=b||e.pointsxy,a.beginPath(),a.moveTo(b[0],b[1]),a.bezierCurveTo(b[2],b[3],b[4],b[5],b[6],b[7]),a.stroke()},e.init()},a.pathslider.defaults={gripClass:"",rotateGrip:!0,useCanvas:!0,curve:{width:4,color:"#333",cap:"round"},points:[0,50,50,-50,-50,-50,250,50],value:50,dataPoints:100,tolerance:3,range:30},a.fn.pathslider=function(b,c){return this.each(function(){var d,e=a(this).data("pathslider");if((typeof b).match("object|undefined")){if(e)return e.redraw();new a.pathslider(this,b)}else/\d/.test(b)&&!isNaN(b)&&e&&(d="number"==typeof b?b:parseInt(a.trim(b),10),d>=0&&d<=100&&e.setSlider(d,c))})},a.fn.getpathslider=function(){return this.data("pathslider")}}(jQuery);